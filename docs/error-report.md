# 장애대응

## 1. 장애 공지
- 목적 : 장애 발생 사실을 빠르게 전파하여 관련 부서와 이해관계자들이 상황을 공유할 수 있도록 합니다.
- 방법 : 사내 공지툴(Slack등)을 활용하여 간단히 알립니다.
  - 포함 내용: 장애 발생 여부, 영향 서비스, 현재 조치 진행 중임을 알립니다.
  - 세부 원인보다는 러프한 상황 공유를 우선하여 속도를 확보합니다.

## 2. 장애 복구

#### 1) 장비증설
- 트래픽이 과도하게 몰리거나 변경된 코드가 시스템에 부하를 주는 경우 장비를 증설합니다.

#### 2) 롤백
- 트래픽 급증이 원인이 아닌 경우, 장애 직전 시점의 변경사항(코드/인프라 설정 등)을 확인 후 즉시 롤백합니다.
- 단순 코드뿐 아니라 DB 스키마, 인프라 파라미터 등 환경 설정 변경도 포함합니다.

#### 3) 핫픽스
- 롤백이 불가능한 경우, 문제 부분을 빠르게 수정하여 핫픽스를 적용합니다.
- 원칙
  - 반드시 원인이 명확해야 한다.
  - 페어 리뷰 및 베타 환경 검증 후 적용해야 한다. 이는 시간은 더 소요되더라도, 안전하게 해결하는 것을 최우선이기 때문입니다.

## 3. 장애 전파
장애가 종료된 후에는 투명한 공유와 기록이 필요합니다.

#### 장애 보고서 작성 항목
- 장애 발생 시각 / 탐지 시각 / 종료 시각
- 장애 탐지 방법 (모니터링 알람, 고객 문의 등)
- 장애 발생 지점 (서비스, 모듈, 인프라 계층 등)
- 장애 복구 방법 (증설/롤백/핫픽스 등)
- 대응 과정의 시간별 액션 로그
- 장애 원인 분석
- 재발 방지 대책 및 후속 조치 계획


## 가상의 장애 보고서
#### 장애 탐지 방법
- 모니터링 알림 : 결제 API p95 > 5초 임계치 초과
- 고객 문의 : "결제가 진행되지 않는다"는 콜센터 접수 다수
#### 장애 발생 지점
- 서비스 계층 : 주문/결제 API
- 인프라 계층 : 결제 DB(Connection 고갈, 슬로우 쿼리)
#### 장애 복구 방법
- 장비 증설: DB Connection Pool 크기 50 → 100 확장
- 롤백: 신규 배포된 결제 검증 로직 롤백
- 트래픽 분산: Read Replica를 활성화하여 조회 트래픽 분산

#### 대응 과정의 시간별 액션 로그
```
10:15 : 결제 시도 지연 발생 (고객 결제 실패율 급증)

10:20 : APM 알람, 고객센터 문의 접수

10:25 : 인프라 지표 확인 → Connection Pool 포화 확인

10:30 : Pool 크기 50 → 100 확장

10:35 : Read Replica 활성화 및 라우팅 조정

10:40 : 최근 배포된 결제 검증 로직 롤백

10:45 : 응답 시간 정상화 시작

10:50 : 서비스 정상화 확인
```

#### 장애 원인 분석
- 프로모션 시작과 동시에 결제 트래픽 급증
- 신규 배포된 결제 검증 로직에서 인덱스 미사용 쿼리 발생
- DB 응답 지연으로 Connection Pool 고갈 → 결제 API 타임아웃 증가

#### 재발 방지 대책 및 후속 조치 계획
- 쿼리 최적화 및 인덱스 추가
- 피크 트래픽을 고려하여 리소스 확장